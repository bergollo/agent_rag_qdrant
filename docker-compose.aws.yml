services:
  frontend:
    image: ${ECR_REGISTRY}/frontend:${TAG}
    ports: ["8080:8080"]
    depends_on: [backend, ai_service]
    restart: unless-stopped

  backend:
    image: ${ECR_REGISTRY}/backend:${TAG}
    environment:
      AI_SERVICE_URL: http://ai_service:8080
      QDRANT_URL: http://qdrant:6333
    ports: ["8000:8080"]
    depends_on: [ai_service, qdrant]
    restart: unless-stopped

  ai_service:
    image: ${ECR_REGISTRY}/ai_service:${TAG}
    ports: ["8001:8080"]
    environment:
      REDACTION_URL: http://redaction_gate:8080
      QDRANT_URL: http://qdrant:6333
      OPENAI_API_KEY: ${OPENAI_API_KEY}
    depends_on: [redaction_gate, qdrant]
    restart: unless-stopped

  redaction_gate:
    image: ${ECR_REGISTRY}/redaction_gate:${TAG}
    ports: ["8002:8080"]
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:latest
    ports: ["6333:6333", "6334:6334"]
    volumes: [qdrant_data:/qdrant/storage]
    restart: unless-stopped

volumes:
  qdrant_data:
